# Offtext 標記格式
設計思路：
* 兼容於純文本，添加必要的結構及定址信息。
* 容易剖析及轉換成其他格式。
* 在內存表現為字符串陣列，而非XML複雜的樹狀結構。
* 文件的任何一行或多行，都是合式文件。
* 讓腳注、紙質頁碼、科判、異讀、校勘等等後加信息從底文剝離。
[文本編碼](text-encoding.md)

## 文層
「文層」即是將文件分成多個層次，取自圖片編輯軟件「圖層」(layers)的概念。
在「前Photoshop」時代，圖片編輯軟件沒有圖層概念，只能用「Undo」方式回複編輯錯誤。
目前以XML為代表的樹基文件，本質上就是將「正文」與「結構信息」混雜在同一棵樹。

其後果是，為正文增添更多信息，會降低「正文」的操作通透性(interoperatability)。
嚴重制約應用場景以及延伸迭代的可能性，甚至有被犧牲掉的可能（返祖回純文本）。

有了文層的概念，不同型態的後加信息（如不同用戶的批注、校釋）儲存在不同的工作平面，與「底文」彼此不相互干擾，也很容易疊加呈現。（顯示或隱藏圖層。）

文層的機制就像標注於透明薄片再疊在底圖上，而非直接在地圖上作畫。

文層可以清楚地分割所有權，讓古籍數字加工的分工成為可能。例如，核心古籍如易經，屬於公共文化材，而注解易經的作品，因為在不同的文層，在獨立的儲存空間，因此可以擁有完整的著作權。這樣依附於古籍的後加信息可以不斷的積累，古籍也不受後加信息的授權條款所約束。

## 定址
對 XML 來說，因為後加信息和正文在同一個儲存結構，所以沒有定位的問題，但XML無法在不修改正文的前提下，增添後加信息，而每一次的增添，又導致新的版本產生。

要將一個文件化為文層，就必須解決定位的問題，以「加粗強調」這個後加信息為例，
關鍵不是粗細顏色等樣式，而是加在那裡。

## offtag 標記

標記以 ^ 開頭，標記名稱必須英文小寫，且在一行內結束。標記正則表達式見 offtext/def.js
和 XML 不同的是 offtag 沒有開閉的觀念，offtag 等效於XML 的 empty tag <tag />。

只有 簡單id 或 地址 的標記。
    ^標記名#簡單id                       //  id 必須是 a-z (小寫) ，數字 或 _ - . 
    ^標記名數字起頭的id                   //  id 以數字起頭，則 # 可省略 ，例:  ^f7   (id為"7"的注腳)
    ^標記名@地址                         //  地址 必須是 a-z (小寫) ，數字 或 _ - . :

帶屬性陣列的標記：

    ^標記名[屬性=值]                            // 帶屬性的標記，多組以空格隔開，值的雙引號可省略
    ^標記名[屬性=值 屬性="帶 空格 的值"]    // 有空格的值必須有雙引號
    ^標記名[包夾文字]                                 // 包夾文字的標記  例：^b[加粗的文字]
    ^標記名[屬性=值 包夾文字]                 //  帶屬性及包夾文字，例： ^a[id=dn2.372 大念住經]

屬性名可以是任意英文(大小寫皆可)及中文，特殊的屬性名稱有兩個，# (id) 及 @ (hook)
    ^f7 為 ^f[id=7] 之簡寫 ，^f[#帶中文及大寫英文字母的id] 不能簡寫
    ^t@dn1.1 為 ^t[@dn1.1] 之簡寫

## 基本標記

    ^bk     書  (有名稱，有唯一的代號）
    ^ck     綣  (一個可捲動的閱讀單元）
    ^n      段落，可帶數字 如 ^n272 ，^n851-860 (連號)

## 綣 chunk

    ^ck 定義綣。
長部及中部一經一chunk，相經部及增支部一個vagga一chunk，約十經左右。清淨道論一章一chunk。

## 段落

   ^n數字  有號段
   ^n         無號段

## 換行 linebreak

    即純文本的換行符，無須特別標記。

## 定址原則
原則上最多兩層定址。如  bk.ck （第幾冊的第幾綣）或  bk.n （第幾冊的第幾段）
然後是從該綣起算的第幾行。

## pin 文釘 ：
定址到行為止，要精確到字，必須用文釘。

前釘，定位斷句

    abc       首個"abc"出現的位置
    abc:2     第三個"abc"的位置
    
後釘，定位腳注

    :abc      首個"abc"出現的位置加 "abc"的長度
    2:abc     第三個"abc"出現的位置加 "abc"的長度
