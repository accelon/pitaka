# Pitaka

## 結構
一個 籃子 (basket，巴利語Pitaka) 由若干個檔構成，包含了內文、輔助連結的資料結構，可能包括全文索引。

每個籃子有若干個命名空間(namespace) ，原則上每個 htm 檔案產生一個命名空間，
如果htm太大，可分拆成小檔，依然是同一個命名空間。

每個htm只能有一個　`<htll>` 包住整個檔案，其他的標籤不能跨行。
    big.1.htm big.2.htm big.3.htm  //命名空間  是 `big`

## HTML 預覽
    加上這個style屬性，過長的行會自動折行。
    <htll style="white-space:pre-wrap">

    如果不想看到瀏覽器警告「quirky mode」，一開始加上
    <!DOCTYPE html><htll style="white-space:pre-wrap">

## 識別符
每個命名空間中的識別符名稱必須唯一。定義識別符方式為  `<a name="識別符"/>` ，
在每行的開頭定義，前方不能有文字，可以定義多個識別符。如：

    <a name="j1"/><h2>素問第一卷</h2>
    <a name="1"/><a name="上古天真論"/><h3>上古天真論篇第一</h3>

識別符預設為「階層數字」格式為  `數字.數字.數字`  ，數字為大於等於0的整數，層級不限。

    1
    1.0   //不行，與 1 等效
    1.0.1  //可以從 零開始
    1.1
    1.1.1
    1.3    //不行，要先有1.2

### 識別符標題
預設識別符: 標記之後的文字，自動會視為標題。
命名空間的標題，為在`<htll>`之後的文字，可用 ; 隔開多個名稱

    yi.htm 
    <htll><h1>易經;周易;易</h1>
    用「易」「周易」「易」都可以查到命名空間 yi

### 識別符樣版
`＜htll aname="j1">` 以aname屬性定義識別符樣版
多個樣版以 `;` 隔開，如 `<htll aname="j1;sn2">`

與`<htll>` 同行的文字將作為書名，一書多名以;隔開，如

    詩經;毛詩

`j1` 表示`j`之後只能有一個數字。如 `j0` `j1` `j100` ，表示卷號。
`sn2` 表示最多兩級數字，如 `sn1.1` `sn56` `sn56.11`，而 `sn4.1.4` 不符合規定。

數字型的儲存效率高，在建籃時會檢查，盡可能採用數字型的識別符。

### 文字型識別符
如果不是階層數字，也不符合識別符樣版，則為文字型識別符。

識別符是機器與人的橋樑，必須同時對兩者具有意義，
例如詞典的詞條，每個詞條給於數字識別符不具太大意義，

如果有大量的文字型識別符，可採用文字式檔案，而不必用`<a name="">`方式定義。


## 位址語法 (兼容HTML)

    同一個basket內，同一個命名空間
    <a href="#ID">跳到這個ID</a>
    <a href="?p=3#ID">跳到 ID 再跳過3段 ，到第四段開頭</a>
    <a href="?s=tofind#ID">從ID開始尋找字串tofind</a>
    
    到其他命名空間的某個ID
    <a href="big.1.htm#ID>   // 命名空間 是big

    到其他籃子 ，必須以 ../htll- 前綴，這樣在未產生籃子之前也可以用瀏覽器測試
    <a href="../htll-cct/lunyu.htm#ID>   //cct 是籃子 , lunyu是命名空間

## 生成籃子

    npx build

## 文件進化階段
1. 讀取：多個純文字檔（不限格式）合併成籃子，只能以絕對行號取得內容。
    - 檔頭：版本、總行數、每個jsonp的起始行陣列。

2. 分段：以定義識別符、章節等文件結構。

3. 全文索引。


## 分散式 JSONP
1. 大約每256KB一個js 檔，file:// 也可以隨需讀取
2. 未來再考慮包成單一檔案。
3. 最多分成 999 個檔。檔頭為000.js，其他檔名為 001.js ~ 999.js 
